<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Lucien</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Lucien">
<meta property="og:url" content="https://lzk-ys.github.io/index.html">
<meta property="og:site_name" content="Lucien">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lucien">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Lucien</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">个人博客</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://lzk-ys.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Back-Propagation-反向传播" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/11/06/Back-Propagation-反向传播/" class="article-date">
  <time datetime="2018-11-06T02:46:00.000Z" itemprop="datePublished">2018-11-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/机器学习/">机器学习</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/11/06/Back-Propagation-反向传播/">Back-Propagation-反向传播</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>链式法则<br>多元链式法则：指出如果变量在线路中分支走向不同的部分，那么梯度在回传的时候，就应该进行累加。</p>
<p>点积<br>内积</p>
<p>MNIST<br>每个图片都是28*28=784像素的，需要将每张图片按照相同的顺序展开。<br>展平图片的数字数组会丢失图片的二维结构信息。这显然是不理想的。所介绍的简单数学模型，softmax回归(softmax regression)，不会利用这些结构信息。</p>
<p>在MNIST训练数据集中，mnist.train.images 是一个形状为 [60000, 784] 的张量，第一个维度数字用来索引图片，第二个维度数字用来索引每张图片中的像素点。在此张量里的每一个元素，都表示某张图片里的某个像素的强度值，值介于0和1之间。</p>
<p>相对应的MNIST数据集的标签是介于0到9的数字，用来描述给定图片里表示的数字。为了用于这个教程，我们使标签数据是”one-hot vectors”。 一个one-hot向量除了某一位的数字是1以外其余各维度数字都是0。所以在此教程中，数字n将表示成一个只有在第n维度（从0开始）数字为1的10维向量。比如，标签0将表示成([1,0,0,0,0,0,0,0,0,0,0])。因此， mnist.train.labels 是一个 [60000, 10] 的数字矩阵。</p>
<p>softmax回归（softmax regression）模型的经典案例。softmax模型可以用来给不同的对象分配概率。<br>创建模型</p>
<p>训练模型</p>
<p>权重初始化</p>
<p>为了创建这个模型，我们需要创建大量的权重和偏置项。这个模型中的权重在初始化时应该加入少量的噪声来打破对称性以及避免0梯度。由于我们使用的是ReLU神经元，因此比较好的做法是用一个较小的正数来初始化偏置项，以避免神经元节点输出恒为0的问题（dead neurons）。为了不在建立模型的时候反复做初始化操作，我们定义两个函数用于初始化。</p>
<p>def weight_variable(shape):<br>  initial = tf.truncated_normal(shape, stddev=0.1)<br>  return tf.Variable(initial)</p>
<p>def bias_variable(shape):<br>  initial = tf.constant(0.1, shape=shape)<br>  return tf.Variable(initial)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzk-ys.github.io/2018/11/06/Back-Propagation-反向传播/" data-id="cjvhsv3bm0008xxw941btm2co" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Convolutional-neural-network" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/31/Convolutional-neural-network/" class="article-date">
  <time datetime="2018-10-31T02:40:04.000Z" itemprop="datePublished">2018-10-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/机器学习/">机器学习</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/31/Convolutional-neural-network/">Convolutional-neural-network</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这篇文章将介绍卷积神经网络的概念及在 TensorFlow 中的使用方法。<br>s(t) = (x * w)(t)<br>x: 输入（input）<br>w: 核函数（kernel function）<br>输出，也被称作特征映射（feature map）</p>
<p>我们经常一次在多个维度上进行卷积运算。<br>单独使用卷积运算在机器学习中是很少见的，卷积经常与其他函数一起使用。无论卷积运算是否对它的核进行了翻转，这些函数的组合通常是不可交换的。</p>
<p>This keyword spotting(KWS) system runs on mobile devices, and therefore must have a small memory footprint and low computational power.<br>KWS 运行在移动设备上，应该有小的内存占用和低计算量。</p>
<p>This weight sharing helps to model local correlations in the input signal.<br>权重矩阵的共享有助于模拟输入信号中的局部相关性。</p>
<p>以下为 speech_commands 项目中，生成conv卷积模型的代码，对于其中用到的卷积原理和 TensorFlow API 我们将进行详细的讲解：</p>
<p>在这个模型中运行了两次卷积运算</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">def create_conv_model(fingerprint_input, model_settings, is_training):</span><br><span class="line">    &quot;&quot;&quot;Builds a standard convolutional model.</span><br><span class="line"></span><br><span class="line">    This is roughly the network labeled as &apos;cnn-trad-fpool3&apos; in the</span><br><span class="line">    &apos;Convolutional Neural Networks for Small-footprint Keyword Spotting&apos; paper:</span><br><span class="line">    http://www.isca-speech.org/archive/interspeech_2015/papers/i15_1478.pdf</span><br><span class="line"></span><br><span class="line">    Here&apos;s the layout of the graph:</span><br><span class="line"></span><br><span class="line">    (fingerprint_input)</span><br><span class="line">          v</span><br><span class="line">      [Conv2D]&lt;-(weights)</span><br><span class="line">          v</span><br><span class="line">      [BiasAdd]&lt;-(bias)</span><br><span class="line">          v</span><br><span class="line">        [Relu]</span><br><span class="line">          v</span><br><span class="line">      [MaxPool]</span><br><span class="line">          v</span><br><span class="line">      [Conv2D]&lt;-(weights)</span><br><span class="line">          v</span><br><span class="line">      [BiasAdd]&lt;-(bias)</span><br><span class="line">          v</span><br><span class="line">        [Relu]</span><br><span class="line">          v</span><br><span class="line">      [MaxPool]</span><br><span class="line">          v</span><br><span class="line">      [MatMul]&lt;-(weights)</span><br><span class="line">          v</span><br><span class="line">      [BiasAdd]&lt;-(bias)</span><br><span class="line">          v</span><br><span class="line"></span><br><span class="line">    This produces fairly good quality results, but can involve a large number of</span><br><span class="line">    weight parameters and computations. For a cheaper alternative from the same</span><br><span class="line">    paper with slightly less accuracy, see &apos;low_latency_conv&apos; below.</span><br><span class="line"></span><br><span class="line">    这个模型产生了相当高质量的结果，但是会涉及大量的权重参数和计算量。对于一个可选的有更低精度的模型，请看 low_latency_conv 方法。</span><br><span class="line"></span><br><span class="line">    During training, dropout nodes are introduced after each relu, controlled by a placeholder.</span><br><span class="line"></span><br><span class="line">    在训练期间，在每个relu之后引入丢失节点（dropout nodes），由占位符控制。</span><br><span class="line"></span><br><span class="line">    Args:</span><br><span class="line">    fingerprint_input: TensorFlow node that will output audio feature vectors.</span><br><span class="line">    TensorFlow 节点将要输出输出音频特征向量。</span><br><span class="line"></span><br><span class="line">    model_settings: Dictionary of information about the model.</span><br><span class="line">    关于模型的设置信息的字典</span><br><span class="line"></span><br><span class="line">    is_training: Whether the model is going to be used for training.</span><br><span class="line">    是否这个模型将要被用于训练</span><br><span class="line"></span><br><span class="line">    Returns:</span><br><span class="line">    TensorFlow node outputting logits results, and optionally a dropout</span><br><span class="line">    placeholder.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if is_training:</span><br><span class="line">        dropout_prob = tf.placeholder(tf.float32, name=&apos;dropout_prob&apos;)</span><br><span class="line">    input_frequency_size = model_settings[&apos;dct_coefficient_count&apos;]</span><br><span class="line">    input_time_size = model_settings[&apos;spectrogram_length&apos;]</span><br><span class="line">    fingerprint_4d = tf.reshape(fingerprint_input, [-1, input_time_size, input_frequency_size, 1])</span><br><span class="line"></span><br><span class="line">    first_filter_width = 8</span><br><span class="line">    first_filter_height = 20</span><br><span class="line">    first_filter_count = 64</span><br><span class="line">    first_weights = tf.Variable(</span><br><span class="line">        tf.truncated_normal(</span><br><span class="line">            [first_filter_height, first_filter_width, 1, first_filter_count],</span><br><span class="line">            stddev=0.01</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    first_bias = tf.Variable(tf.zeros([first_filter_count]))</span><br><span class="line">    first_conv = tf.nn.conv2d(fingerprint_4d, first_weights, [1, 1, 1, 1], &apos;SAME&apos;) + first_bias</span><br><span class="line">    first_relu = tf.nn.relu(first_conv)</span><br><span class="line">    if is_training:</span><br><span class="line">        first_dropout = tf.nn.dropout(first_relu, dropout_prob)</span><br><span class="line">    else:</span><br><span class="line">        first_dropout = first_relu</span><br><span class="line">    max_pool = tf.nn.max_pool(first_dropout, [1, 2, 2, 1], [1, 2, 2, 1], &apos;SAME&apos;)</span><br><span class="line">    second_filter_width = 4</span><br><span class="line">    second_filter_height = 10</span><br><span class="line">    second_filter_count = 64</span><br><span class="line">    second_weights = tf.Variable(</span><br><span class="line">        tf.truncated_normal(</span><br><span class="line">            [second_filter_height, second_filter_width, first_filter_count, second_filter_count],</span><br><span class="line">            stddev=0.01</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    second_bias = tf.Variable(tf.zeros(second_filter_count))</span><br><span class="line">    second_conv = tf.nn.conv2d(max_pool, second_weights, [1, 1, 1, 1], &apos;SAME&apos;) + second_bias</span><br><span class="line">    second_relu = tf.nn.relu(second_conv)</span><br><span class="line"></span><br><span class="line">    if is_training:</span><br><span class="line">        second_dropout = tf.nn.dropout(second_relu, dropout_prob)</span><br><span class="line">    else:</span><br><span class="line">        second_dropout = second_relu</span><br><span class="line"></span><br><span class="line">    second_conv_shape = second_dropout.get_shape()</span><br><span class="line">    second_conv_output_width = second_conv_shape[2]</span><br><span class="line">    second_conv_output_height = second_conv_shape[1]</span><br><span class="line">    second_conv_element_count = int(</span><br><span class="line">        second_conv_output_width * second_conv_output_height * second_filter_count</span><br><span class="line">    )</span><br><span class="line">    flattened_second_conv = tf.reshape(second_dropout, [-1, second_conv_element_count])</span><br><span class="line">    label_count = model_settings[&apos;label_count&apos;]</span><br><span class="line">    final_fc_weights = tf.Variable(</span><br><span class="line">        tf.truncated_normal(</span><br><span class="line">            [second_conv_element_count, label_count], stddev=0.01</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    final_fc_bias = tf.Variable(tf.zeros([label_count]))</span><br><span class="line">    final_fc = tf.matmul(flattened_second_conv, final_fc_weights) + final_fc_bias</span><br><span class="line"></span><br><span class="line">    if is_training:</span><br><span class="line">        return final_fc, dropout_prob</span><br><span class="line">    else:</span><br><span class="line">        return final_fc</span><br></pre></td></tr></table></figure>
<p>核心参数<br>dct_coefficient_count  频率大小，为什么默认为40 ？<br>sample_rate 音频的采样率，默认 16000，单位是 HZ/s<br>clip_duration_ms 样本音频的时长<br>window_size_ms ？？</p>
<p>weights<br>bias<br>超参数<br>fully connected 完全连接<br>ReLu(Rectified Linear Units)激活函数<br>dropout 消除过拟合</p>
<p>一个典型的卷积层包括三级：<br>一级：卷积操作，得到特征映射。<br>二级：非线性函数，例如：Relu 激活函数<br>三级：池化函数，最常见的是最大值池化和平均值池化</p>
<p>池化：<br>使用池化可以看作增加了一个无限强的先验：这一层学得的函数必须具有对少量平移的不变性。当这个假设成立时，池化可以极大地提高网络的统计效率。</p>
<p>在这种最常见的情况下，通过tf.truncated_normal函数初始化权重变量，给赋予的shape则是一个二维tensor，其中第一个维度代表该层中权重变量所连接（connect from）的单元数量，第二个维度代表该层中权重变量所连接到的（connect to）单元数量。</p>
<p>然后，通过tf.zeros函数初始化偏差变量（biases），确保所有偏差的起始值都是0，而它们的shape则是其在该层中所接到的（connect to）单元数量。</p>
<p>初始化全部的 tf.Variable实例，以下两种初始化变量的方法的区别：<br>sess.run(tf.initialize_all_variables())<br>sess.run(tf.global_variables_initializer())<br>sess.run()方法将会运行图表中与作为参数传入的操作相对应的完整子集。在初次调用时，init操作只包含了变量初始化程序tf.group。图表的其他部分不会在这里，而是在下面的训练循环运行。</p>
<p>我体会到各种教程中，会调用不同的 TF API 但是却没有对区别进行说明，很容易让读者产生困惑。</p>
<p>参数数量的计算方法<br>每一层参数个数 = 每一层的神经元的个数 * （每个神经元的权重数 + 1个偏差）</p>
<h4 id="权重矩阵初始化"><a href="#权重矩阵初始化" class="headerlink" title="权重矩阵初始化"></a>权重矩阵初始化</h4><p>权重矩阵 first_weights 的初始化，是通过 tf.truncated_normal()，即从截断的正态分布产生的随机值。<br>那么为什么要如此产生权重矩阵呢？</p>
<p>为什么使用卷积神经网络？<br>在处理图像这样的高维度输入时，让每个神经元都与前一层中的所有神经元进行全连接是不现实的。<br>用卷积神经网络隐藏层中的神经元将只与前一层中的一小块区域连接，而不是采取全连接方式。</p>
<p>卷积层和全连接层（CONV/FC）对输入执行变换操作的时候，不仅会用到激活函数，还会用到很多参数（神经元的突触权值和偏差）。而ReLU层和汇聚层则是进行一个固定不变的函数操作。卷积层和全连接层中的参数会随着梯度下降被训练，这样卷积神经网络计算出的分类评分就能和训练集中的每个图像的标签吻合了。</p>
<p>卷积层的参数是有一些可学习的滤波器集合构成的。每个滤波器在空间上（宽度和高度）都比较小，但是深度和输入数据一致。</p>
<p>卷积层中的每个神经元只观察输入数据中的一小部分。</p>
<p>3个超参数控制着输出数据体的尺寸：深度（depth），步长（stride）和零填充（zero-padding）<br>输出数据体在空间上的尺寸可以通过输入数据体尺寸（W），卷积层中神经元的感受野尺寸（F），步长（S）和零填充的数量（P）的函数来计算。</p>
<p>Keyword Spotting</p>
<p>CLSTM framework and multi-task Learing (MTL）framework</p>
<p>Recently, deep learning methods have been explored<br>for TDSV task where the DNN models are not directly used for<br>classification, but rather as a feature extractor which provides<br>speaker specific embeddings.</p>
<p>The performance of the DNN based approaches for TDSV<br>rely heavily on the availability of large amounts of background<br>training data. However, in many practical scenarios, the amount<br>of text dependent training data for background speakers would<br>be rather limited. In such a scenario, the GMM-UBM based<br>modeling continues to outperform the DNN based TDSV approaches<br>[9].<br>基于DNN的TDSV方法的性能高度依赖于大量的背景训练数据，而在实际场景中背景训练数据相当有限，基于GMM-UBM建模继续优于基于DNN的TDSV方法[9]。<br>原因： 使用 dropout 减少过度拟合，增加泛化的能力<br>This is primarily due to the over-training of the<br>DNN models on the training speakers and the DNN embeddings<br>do not generalize well to new speakers. The most common strategy<br>to overcome this is with pre-training and regularization approaches<br>like dropout [10]. For small amount of background<br>training, even with dropout methods, the DNN based models<br>(with the best choice of architecture and activation functions)<br>provides an equal error rate (EER) which is about twice the<br>GMM-UBM system [9].</p>
<p>The proposed model uses speech spectrogram<br>from a large contextual window (approximately of the duration<br>of the keyword of interest) processed with CNN feature embeddings<br>which are shared for both the KWS and TDSV tasks.<br>所提出的模型使用语音谱图<br>从一个大的上下文窗口（大约持续时间<br>感兴趣的关键词）用CNN特征嵌入处理<br>这些是KWS和TDSV任务共享的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzk-ys.github.io/2018/10/31/Convolutional-neural-network/" data-id="cjvhsv3bt000cxxw9yufol5id" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="convolutional-neural--network-1" class="article article-type-convolutional-neural-" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/31/network-1/" class="article-date">
  <time datetime="2018-10-31T02:39:56.000Z" itemprop="datePublished">2018-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/31/network-1/">network</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzk-ys.github.io/2018/10/31/network-1/" data-id="cjvhsv3c7000xxxw9j0v0abzd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="convolutional-network" class="article article-type-convolutional" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/10/31/network/" class="article-date">
  <time datetime="2018-10-31T02:39:40.000Z" itemprop="datePublished">2018-10-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/10/31/network/">network</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzk-ys.github.io/2018/10/31/network/" data-id="cjvhsv3c90012xxw9k63j6ntq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android-开发手册" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/23/Android-开发手册/" class="article-date">
  <time datetime="2018-03-23T01:52:58.000Z" itemprop="datePublished">2018-03-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/23/Android-开发手册/">Android 开发手册</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>原则：掌握开发规范更要掌握背后的原理</p>
<p>参考文献：<br>阿里巴巴 Android 开发手册<br>博客：<br><a href="https://zmywly8866.github.io/2014/12/26/android-do-not-store-data-in-the-application-object.html" target="_blank" rel="noopener">https://zmywly8866.github.io/2014/12/26/android-do-not-store-data-in-the-application-object.html</a></p>
<p><a href="https://zmywly8866.github.io/2014/12/26/android-do-not-store-data-in-the-application-object.html" target="_blank" rel="noopener">不要在Android的Application对象中缓存数据! 转载</a><br>Note:不仅仅只有Application对象是这样的，其它的单例或者公有静态类也有可能会由于系统内存而被杀掉，谨记。</p>
<p>[强制] Application 中，确保只在自己需要的进程初始化<br>[详细参考](<a href="https://blog.csdn.net/wx_jin/article/details/50894058" target="_blank" rel="noopener">https://blog.csdn.net/wx_jin/article/details/50894058</a></p>
<p>[强制] 新建线程时，必须通过线程池提供（AsyncTask 或者 ThreadPoolExecutor 或者其他形式自定义的线程池），不允许在应用中自行显示的创建线程。<br>参考：阿里 Android 开发手册</p>
<p>[强制] 线程池不允许使用 Executors 创建， 而是通过 ThreadPoolExecutor 的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。<br>说明：<br>Executors 返回的线程池对象的弊端如下：</p>
<ol>
<li>FixedThreadPool 和 SingleThreadPool ： 允许的请求队列长度为Integer.MAX_VALUE, 可能会堆积大量的请求，从而导致OOM（why?）</li>
<li>CachedThreadPool 和 ScheduledThreadPool ：允许的创建线程数量为Integer.MAX_VALUE，可能会创建大量的线程，从而导致OOM。<br>参考：阿里 Android 开发手册</li>
</ol>
<p>[推荐] ThreadPoolExecutor 设置线程存活时间(setKeepAliveTime)，确保空闲时线程能被释放。<br>说明：<br>不设置 setKeepAliveTime 时，默认是什么？</p>
<p>疑惑：<br>Android 开发中，如何更方便地使用线程，因为开发中会在很多地方处理网络请求，尤其是IO操作，如何更便捷地处理？<br>例如：数据库，文件，读取Bitmap</p>
<p>文件与数据库<br>[强制] 应用间共享文件时，不要通过放宽文件系统权限的方式去实现，而是应该使用FileProvider。<br>参考：阿里 Android 开发手册</p>
<p>[强制] 多线程操作写入数据库时，需要使用事务，以免出现同步问题。<br>单个 App 中应使用 SQLiteOpenHelper 的单例模式确保数据库连接唯一。<br>参考：阿里 Android 开发手册</p>
<p>Bitmap、Drawable 与动画<br>[强制] 加载大图片或者一次性加载多张图片，应该在异步线程中进行。图片的加载，涉及到 IO 操作，以及 CPU 密集操作，很可能引起卡顿。</p>
<p>[强制] png 图片使用 tinypng 或者类似工具压缩处理，减少包体积。</p>
<p>[推荐] 根据实际展示需要，压缩图片，而不是直接显示原图。</p>
<p>[强制] 使用完毕的图片，应该及时回收，释放宝贵的内存。</p>
<p>[强制] 在 Activity.onPause() 或 Activity.onStop() 回调中，关闭当前 activity 正在执行的动画。否则会导致 UI 线程延迟。</p>
<p>[推荐] 使用 BitmapFactory.Options.inBitmap 重复利用内存空间，避免重复开辟新内存。</p>
<p>[推荐] 使用 RGB_565 代替 ARGB_8888，在不怎么影响视觉效果的前提下，减少内存占用。<br>Note: RGB_565 不支持图片本身的透明度。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzk-ys.github.io/2018/03/23/Android-开发手册/" data-id="cjvhsv3bl0007xxw906ikh2we" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android-技术细节" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/25/Android-技术细节/" class="article-date">
  <time datetime="2018-02-25T09:08:35.000Z" itemprop="datePublished">2018-02-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/25/Android-技术细节/">Android 技术细节</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Android中代替枚举的@IntDef用法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@IntDef(flag = true, value = &#123;  </span><br><span class="line">    OPERATION_UNKNOWN,</span><br><span class="line">    OPERATION_COPY,</span><br><span class="line">    OPERATION_MOVE,</span><br><span class="line">    OPERATION_DELETE</span><br><span class="line">    &#125;)</span><br><span class="line">@Retention(RetentionPolicy.SOURCE)</span><br><span class="line">public @interface OpType &#123;&#125;</span><br><span class="line">public static final int OPERATION_UNKNOWN = -1;</span><br><span class="line">public static final int OPERATION_COPY = 1;</span><br><span class="line">public static final int OPERATION_MOVE = 2;</span><br><span class="line">public static final int OPERATION_DELETE = 3;</span><br></pre></td></tr></table></figure></p>
<p>参考文献：<br><a href="https://www.jianshu.com/p/422b7a91835a" target="_blank" rel="noopener">https://www.jianshu.com/p/422b7a91835a</a></p>
<blockquote>
<p>Textview可以通过为 TextView 设置 android:gravity=”center” 来实现在父布局中实现居中显示，该方法针对FrameLayout有效，LinearLayout 无效。  </p>
</blockquote>
<p><a href="http://www.loongwind.com/archives/116.html" target="_blank" rel="noopener">TextView 代码里设置随点击状态改变文字颜色</a></p>
<p>Button SDK5.0 以上去除自带阴影效果的方法<br>设置 borderlessButtonStyle 属性就可以去掉自带的阴影，该属性在 API 11 及以上可用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">android:text=&quot;@string/button_send&quot;</span><br><span class="line">android:onClick=&quot;sendMessage&quot;</span><br><span class="line">style=&quot;?android:attr/borderlessButtonStyle&quot; /&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>通过使用String.format() 方法，组织字符串<br>LogManager.getLogger().d(“PhotoViewAttacher”, String.format(“onDrag: dx: %.2f. dy: %.2f”, new Object[]{Float.valueOf(dx), Float.valueOf(dy)}));</p>
</blockquote>
<p><a href="http://www.cnblogs.com/Eric-zhao/p/5230007.html" target="_blank" rel="noopener">android中string.xml中%1$s、%1$d等的用法</a></p>
<p>TextView 正确设置字体颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// true method</span><br><span class="line">textView.setTextColor(mLauncher.getResources().getColor(R.color.extscreen_remind_level3_color));</span><br><span class="line">// false method</span><br><span class="line">textView.setTextColor(R.color.extscreen_remind_level3_color);</span><br></pre></td></tr></table></figure></p>
<p><a href="https://developer.android.com/training/keyboard-input/style.html#AutoComplete" target="_blank" rel="noopener">EditText : Specifying the Input Method Type</a></p>
<p><a href="https://code.tutsplus.com/tutorials/create-a-custom-keyboard-on-android--cms-22615" target="_blank" rel="noopener">Create a Custom Keyboard on Android</a></p>
<blockquote>
<p>在同一个 Android 设备中，两个 App 的 packageName 不能相同，两个 App 中定义的 ContentProvider 的 authorities 也不能相同。</p>
<p>android:descendantFocusability=”blocksDescendants” 避免Item中的控件抢焦点</p>
</blockquote>
<h3 id="waiting-for-research"><a href="#waiting-for-research" class="headerlink" title="waiting for research"></a>waiting for research</h3><p><a href="http://www.flysnow.org/2015/08/13/android-tech-docs-support-annotations.html" target="_blank" rel="noopener">Android注解支持</a><br><a href="https://developer.android.com/studio/write/annotations.html?hl=zh-cn" target="_blank" rel="noopener">使用注解改进代码检查</a></p>
<p><a href="https://yq.aliyun.com/articles/4216" target="_blank" rel="noopener">preload-classes的前世今生</a></p>
<p><a href="https://github.com/google/guava#guava-google-core-libraries-for-java" target="_blank" rel="noopener">Guava: Google Core Libraries for Java</a></p>
<p>Android Studio 中关联 JDK 源码<br>Project Structure - SDK Location - 把 JDK location 处 Use embedded JDK(recommended) 勾选去掉，然后替换为我们本地安装的 JDK 路径。</p>
<p>Mac 查询 JDK 的安装路径<br>running /usr/libexec/java_home -version 1.8</p>
<p>完美解决隐藏Listview和RecyclerView去掉滚动条和滑动到边界阴影的方案<br><a href="https://blog.csdn.net/ming2316780/article/details/51578621" target="_blank" rel="noopener">https://blog.csdn.net/ming2316780/article/details/51578621</a></p>
<p><a href="https://blog.csdn.net/qq_20451879/article/details/79075272" target="_blank" rel="noopener">EditText光标颜色与下划线颜色的设</a></p>
<p>EditText<br>设置输入法显示搜索按钮<br>android:inputType=”text”<br>android:imeOptions=”actionSearch”<br>android:inputType=”text” 会导致EditText 的输入为单行显示，如果需要多行显示内容，可以设置为 android:inputType=”textMultiLine”</p>
<p>应用横竖屏旋转时，避免Activity被销毁，可以在清单中配置如下，注意要加上 screenSize 否则无效<br>android:configChanges=”orientation|keyboardHidden|screenLayout|screenSize”<br><a href="https://www.jianshu.com/p/dbc7e81aead2" target="_blank" rel="noopener">https://www.jianshu.com/p/dbc7e81aead2</a></p>
<p>返回功能<br>@Override<br>public boolean onKeyDown(int keyCode, KeyEvent event) {<br>    if (keyCode == KeyEvent.KEYCODE_BACK &amp;&amp; event.getRepeatCount() == 0)<br>    {<br>        goBack();<br>        return false;<br>    }<br>    return super.onKeyDown(keyCode, event);<br>}</p>
<p>禁止屏幕休眠<br>PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE);<br>mWakeLock = pm.newWakeLock(PowerManager.SCREEN_BRIGHT_WAKE_LOCK, TAG);<br>SCREEN_BRIGHT_WAKE_LOCK 在 android 4.1 is deprecated<br>view.setKeepScreenOn(true);<br>view.setKeepScreenOn(false);<br>两者的区别？<br>private PowerManager powerManager;<br>private PowerManager.WakeLock wakeLock;<br>private static final int WAKE_LOCK_TIMEOUT = 60000; //ms,这个超时时间应该大于语音识别时间<br>powerManager = ((PowerManager) context.getSystemService(POWER_SERVICE));<br>private void startWakeLock(){<br>    releaseWakeLock();<br>    wakeLock = powerManager.newWakeLock(PowerManager.SCREEN_BRIGHT_WAKE_LOCK|PowerManager.ON_AFTER_RELEASE, “PostLocationService”);<br>    wakeLock.acquire(WAKE_LOCK_TIMEOUT);<br>    SimpleLog.d(TAG,”startWakeLock — “);<br>}</p>
<p>private void releaseWakeLock(){<br>    SimpleLog.d(TAG,”releaseWakeLock wakeLock = “+wakeLock);<br>    if(wakeLock != null){<br>        if(wakeLock.isHeld()){<br>            wakeLock.release();<br>        }<br>        wakeLock = null;<br>    }</p>
<p>Screen size<br>Method 1:<br>WindowManager wm = (WindowManager) getSystemService(WINDOW_SERVICE);<br>final DisplayMetrics displayMetrics = new DisplayMetrics();<br>wm.getDefaultDisplay().getMetrics(displayMetrics);<br>int height = displayMetrics.heightPixels;<br>int width = displayMetrics.widthPixels;</p>
<p>Method 2<br>DisplayMetrics dm = getResources().getDisplayMetrics();<br>int densityDpi = dm.densityDpi;</p>
<p>Android判断是否可以使用外网<br><a href="https://blog.csdn.net/z2464342708m/article/details/74638360" target="_blank" rel="noopener">https://blog.csdn.net/z2464342708m/article/details/74638360</a></p>
<p>获取其他应用的 SharedPreferences 信息，注意 Context 不要使用本应用 Context 直接进行获取。<br>try {<br>    Context packageContext = mContext.createPackageContext(COURSE_PACKAGE_NAME,<br>            Context.CONTEXT_IGNORE_SECURITY);<br>    if(packageContext != null){<br>        SharedPreferences sp = packageContext.getSharedPreferences(kCourseP, getMutiProcessMode());<br>        result = sp.getBoolean(kCourseStatus, false);<br>        Log.d(NAME,”isCourseStatus 123”+result);</p>
<pre><code>}
</code></pre><p>} catch (PackageManager.NameNotFoundException e) {<br>    e.printStackTrace();<br>}</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzk-ys.github.io/2018/02/25/Android-技术细节/" data-id="cjvhsv3br000bxxw9k83yfo5j" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Java-技术细节" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/25/Java-技术细节/" class="article-date">
  <time datetime="2018-02-25T09:08:21.000Z" itemprop="datePublished">2018-02-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/25/Java-技术细节/">Java 技术细节</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="通过对象锁，CountDownLatch-进行同步"><a href="#通过对象锁，CountDownLatch-进行同步" class="headerlink" title="通过对象锁，CountDownLatch 进行同步"></a>通过对象锁，CountDownLatch 进行同步</h4><p>private final Object mLock = new Object();<br>private final CountDownLatch mFirstLoad = new CountDownLatch(1);<br>详细说明：</p>
<h4 id="比较两个字符串是否相等"><a href="#比较两个字符串是否相等" class="headerlink" title="比较两个字符串是否相等"></a>比较两个字符串是否相等</h4><p>Objects.equals(authority, other.authority);<br>不再需要再判断 authority.equals(other.authority) 之前先判断 authority 是否为 null, 避免NullPointerException</p>
<h4 id="Override-equals"><a href="#Override-equals" class="headerlink" title="Override equals"></a>Override equals</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public boolean equals(Object o) &#123;</span><br><span class="line">        if (o == null) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (this == o) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (o instanceof RootInfo) &#123;</span><br><span class="line">            RootInfo other = (RootInfo) o;</span><br><span class="line">            return Objects.equals(authority, other.authority)</span><br><span class="line">                    &amp;&amp; Objects.equals(rootId, other.rootId);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="Override-compareTo-T-t-implements-Comparable"><a href="#Override-compareTo-T-t-implements-Comparable" class="headerlink" title="Override compareTo(T t), implements Comparable"></a>Override compareTo(T t), implements Comparable<t></t></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public int compareTo(RootInfo other) &#123;</span><br><span class="line">        // Sort by root type, then title, then summary.</span><br><span class="line">        int score = derivedType - other.derivedType;</span><br><span class="line">        if (score != 0) &#123;</span><br><span class="line">            return score;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        score = compareToIgnoreCaseNullable(title, other.title);</span><br><span class="line">        if (score != 0) &#123;</span><br><span class="line">            return score;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return compareToIgnoreCaseNullable(summary, other.summary);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="Copy-one-array-to-another"><a href="#Copy-one-array-to-another" class="headerlink" title="Copy one array to another"></a>Copy one array to another</h4><p>System.arraycopy(oldArray, 0, newArray, 0, oldArray.length);</p>
<ol>
<li><p>【强制】不要在foreach循环里进行元素的remove/add操作。remove元素请使用Iterator方式，如果并发操作，需要对Iterator对象加锁。<br>当对 ArrayList 进行遍历时，不要在循环体中直接调用实例的 remove 方法，否则会抛出 java.util.ConcurrentModificationException 异常。<br>正确操作：通过迭代器进行遍历，并通过迭代器进行 remove 操作。<br>正例：<br>Iterator<string> iterator = list.iterator();<br>while (iterator.hasNext()) {<br>String item = iterator.next();<br>if (删除元素的条件) {<br>iterator.remove();<br>}<br>}<br>反例：<br>List<string> list = new ArrayList<string>();<br>list.add(“A”);<br>list.add(“B”);<br>for (String item : list) {<br>if (“A”.equals(item)) {<br>list.remove(item);<br>}<br>}<br>说明：以上代码的执行结果肯定会出乎大家的意料，那么试一下把“1”换成“2”，会是同样的结果吗？</string></string></string></p>
</li>
<li><p>【推荐】使用entrySet遍历Map类集合KV，而不是keySet方式进行遍历。 说明：keySet其实是遍历了2次，一次是转为Iterator对象，另一次是从hashMap中取出key所对应的value。而entrySet只是遍历了一次就把key和value都放到了entry中，效率更高。如果是JDK8，使用Map.foreach方法。 正例：values()返回的是V值集合，是一个list集合对象；keySet()返回的是K值集合，是一个Set集合对象；entrySet()返回的是K-V值组合集合。</p>
</li>
</ol>
<ol>
<li>【参考】volatile解决多线程内存不可见问题。对于一写多读，是可以解决变量同步问题，但是如果多写，同样无法解决线程安全问题。如果是count++操作，使用如下类实现：AtomicInteger count = new AtomicInteger(); count.addAndGet(1); 如果是JDK8，推荐使用LongAdder对象，比AtomicLong性能更好（减少乐观锁的重试次数）。</li>
<li>【参考】 HashMap在容量不够进行resize时由于高并发可能出现死链，导致CPU飙升，在开发过程中可以使用其它数据结构或加锁来规避此风险。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzk-ys.github.io/2018/02/25/Java-技术细节/" data-id="cjvhsv3c1000mxxw9iu3mio33" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android-存储访问框架" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/25/Android-存储访问框架/" class="article-date">
  <time datetime="2018-02-25T03:12:38.000Z" itemprop="datePublished">2018-02-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/25/Android-存储访问框架/">Android 存储访问框架</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>参考文献：<br><a href="https://developer.android.google.cn/guide/topics/providers/create-document-provider.html" target="_blank" rel="noopener">Create a Custom Document Provider</a><br><a href="https://developer.android.google.cn/reference/android/provider/DocumentsProvider.html" target="_blank" rel="noopener">DocumentsProvider</a>  </p>
<p>Android 4.4（API 级别 19）引入了存储访问框架 (SAF)。SAF 让用户能够在其所有首选文档存储提供程序中方便地浏览并打开文档、图像以及其他文件。 用户可以通过易用的标准 UI，以统一方式在所有应用和提供程序中浏览文件和访问最近使用的文件。</p>
<p>云存储服务或本地存储服务可以通过实现封装其服务的 DocumentsProvider 参与此生态系统。只需几行代码，便可将需要访问提供程序文档的客户端应用与 SAF 集成。</p>
<p>支持多个用户帐户和临时根目录，如只有在插入驱动器后才会出现的 USB 存储提供程序。</p>
<p>SAF 围绕的内容提供程序是 DocumentsProvider 类的一个子类。在文档提供程序内，数据结构采用传统的文件层次结构：<br><img src="https://developer.android.google.cn/images/providers/storage_datamodel.png" alt=""></p>
<h4 id="支持运行-Android-4-3-及更低版本的设备"><a href="#支持运行-Android-4-3-及更低版本的设备" class="headerlink" title="支持运行 Android 4.3 及更低版本的设备"></a>支持运行 Android 4.3 及更低版本的设备</h4><p>ACTION_OPEN_DOCUMENT Intent 仅可用于运行 Android 4.4 及更高版本的设备。如果您想让应用支持 ACTION_GET_CONTENT 以适应运行 Android 4.3 及更低版本的设备，则应在您的清单文件中为运行 Android 4.4 或更高版本的设备停用 ACTION_GET_CONTENT Intent 过滤器。 应将文档提供程序和 ACTION_GET_CONTENT 视为具有互斥性。如果您同时支持这两者，您的应用将在系统选取器 UI 中出现两次，提供两种不同的方式来访问您存储的数据。 这会给用户造成困惑。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzk-ys.github.io/2018/02/25/Android-存储访问框架/" data-id="cjvhsv3bj0006xxw9032r8akc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Intro-to-Shell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/24/Intro-to-Shell/" class="article-date">
  <time datetime="2018-02-24T09:51:57.000Z" itemprop="datePublished">2018-02-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tools/">Tools</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/24/Intro-to-Shell/">Intro to Shell</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzk-ys.github.io/2018/02/24/Intro-to-Shell/" data-id="cjvhsv3bz000kxxw9fzvmyo2n" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Android-内存泄漏分析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/24/Android-内存泄漏分析/" class="article-date">
  <time datetime="2018-02-24T09:42:55.000Z" itemprop="datePublished">2018-02-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/24/Android-内存泄漏分析/">Android 内存泄漏分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>内存泄漏的危害<br>1、引起OutOfMemoryError<br>2、内存占用高时JVM虚拟机会频繁触发GC, 影响程序响应速度<br>3、内存占用大的程序容易被各种清理优化程序中止，用户也更倾向于卸载这些程序</p>
<p>场景：<br>1、<br>类的静态变量持有大数据对象<br>静态变量长期维持到大数据对象的引用，阻止垃圾回收。</p>
<p>2、<br>非静态内部类的静态实例<br>非静态内部类会维持一个到外部类实例的引用，如果非静态内部类的实例是静态的，就会间接长期维持着外部类的引用，阻止被回收掉。</p>
<p>非静态内部类和匿名内部类会持有外部类的引用，而静态内部类不会。</p>
<p>参考文章：<br><a href="http://www.androiddesignpatterns.com/2013/01/inner-class-handler-memory-leak.html" target="_blank" rel="noopener">http://www.androiddesignpatterns.com/2013/01/inner-class-handler-memory-leak.html</a></p>
<p>3、<br>资源类的对象未关闭<br>资源性对象如 Cursor、Stream、Socket，应该在使用后及时关闭。未在 finally 中关闭，会导致异常情况下资源对象未被释放的隐患。<br>对于使用了BraodcastReceiver，ContentObserver，File，Cursor，Stream，Bitmap等资源的使用，应该在Activity销毁时及时关闭或者注销，否则这些资源将不会被回收，造成内存泄漏。</p>
<p>4、<br>注册对象未反注册<br>未反注册会导致观察者列表里维持着对象的引用，阻止垃圾回收。<br>例如：BroadcastReceiver，EventBus等。</p>
<p>5、<br>Handler临时性内存泄露<br>Handler 通过发送 Message 与主线程交互，Message 发出之后是存储在 MessageQueue 中的，有些 Message 也不是马上就被处理的。在 Message 中存在一个 target，是 Handler 的一个引用，如果 Message 在 Queue 中存在的时间越长，就会导致 Handler 无法被回收。如果 Handler 是非静态的，则会导致 Activity 或者 Service 不会被回收。<br>由于 AsyncTask 内部也是 Handler 机制，同样存在内存泄漏的风险。<br>解决方案：</p>
<p>6、<br>Thread、AsyncTask、Timer引起内存泄露<br>Activity在onDestroy()中处理，View在onDetachedFromWindow()中处理</p>
<p>7、<br>WebView内存泄露</p>
<p>预防：<br>不要维持到 Activity 的长久引用，对 activity 的引用应该和 activity 本身有相同的生命周期。<br>尽量使用context-application代替context-activity<br>Activity 中尽量不要使用非静态内部类，可以使用静态内部类和WeakReference代替。</p>
<p>检测：<br>静态检测<br>　　静态检测主要是检测资源未关闭的情况，Eclipse 和 Android Studio 都可以检测出 IO 或者 Socket 未关闭的情况，然后在 finally 中关闭即可。<br>动态监测<br>　　动态检测主要是依靠 MAT(Memory Analysis Tools) 这个工具。目前主流：LeakCanary<br>具体：<a href="http://mp.weixin.qq.com/s?__biz=MzI0MjE3OTYwMg==&amp;mid=401667209&amp;idx=2&amp;sn=f1a085f8838e59de55927d71260ec83c&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">http://mp.weixin.qq.com/s?__biz=MzI0MjE3OTYwMg==&amp;mid=401667209&amp;idx=2&amp;sn=f1a085f8838e59de55927d71260ec83c&amp;scene=21#wechat_redirect</a></p>
<p>参考资料：<br>Android内存泄漏研究<br><a href="http://mp.weixin.qq.com/s?__biz=MzI0MjE3OTYwMg==&amp;mid=2649547478&amp;idx=1&amp;sn=fec54d62785a6f666ef9c49646871ba9&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">http://mp.weixin.qq.com/s?__biz=MzI0MjE3OTYwMg==&amp;mid=2649547478&amp;idx=1&amp;sn=fec54d62785a6f666ef9c49646871ba9&amp;scene=21#wechat_redirect</a></p>
<p>内存使用分析<br>Android 系统为每个应用分配一个固定大小的内存</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://lzk-ys.github.io/2018/02/24/Android-内存泄漏分析/" data-id="cjvhsv3bb0002xxw9p139x16v" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    <!-- Featured Tags -->

  
    <!-- Short About -->
<section class="visible-md visible-lg">
    <h5><a href="/about/">ABOUT ME</a></h5>
    <div class="short-about">

        

        

        <!-- SNS Link -->
        <ul class="list-inline">
            
            
            

            

            

            
            
            
            
        </ul>
    </div>
</section>

  
    
  <h5>RECENT POSTS</h3>
  <div class="widget">
    <ul>
      
        <li>
          <a href="/2018/11/06/Back-Propagation-反向传播/">Back-Propagation-反向传播</a>
        </li>
      
        <li>
          <a href="/2018/10/31/Convolutional-neural-network/">Convolutional-neural-network</a>
        </li>
      
        <li>
          <a href="/2018/10/31/network-1/">network</a>
        </li>
      
        <li>
          <a href="/2018/10/31/network/">network</a>
        </li>
      
        <li>
          <a href="/2018/03/23/Android-开发手册/">Android 开发手册</a>
        </li>
      
    </ul>
  </div>

  
    <!-- Friends Blog -->

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">6</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Lucien Liu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/js/script.js"></script>

  </div>
</body>
</html>